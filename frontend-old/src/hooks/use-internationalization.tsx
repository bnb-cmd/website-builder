"use client"

import { useState, useEffect, useCallback, createContext, useContext } from 'react'

export type SupportedLanguage = 'en' | 'ur' | 'ar' | 'hi' | 'es' | 'fr' | 'de' | 'zh'

export interface LanguageInfo {
  code: SupportedLanguage
  name: string
  nativeName: string
  rtl: boolean
  flag: string
}

export const SUPPORTED_LANGUAGES: Record<SupportedLanguage, LanguageInfo> = {
  en: { code: 'en', name: 'English', nativeName: 'English', rtl: false, flag: 'ЁЯЗ║ЁЯЗ╕' },
  ur: { code: 'ur', name: 'Urdu', nativeName: '╪з╪▒╪п┘И', rtl: true, flag: 'ЁЯЗ╡ЁЯЗ░' },
  ar: { code: 'ar', name: 'Arabic', nativeName: '╪з┘Д╪╣╪▒╪и┘К╪й', rtl: true, flag: 'ЁЯЗ╕ЁЯЗж' },
  hi: { code: 'hi', name: 'Hindi', nativeName: 'рд╣рд┐рдиреНрджреА', rtl: false, flag: 'ЁЯЗоЁЯЗ│' },
  es: { code: 'es', name: 'Spanish', nativeName: 'Espa├▒ol', rtl: false, flag: 'ЁЯЗкЁЯЗ╕' },
  fr: { code: 'fr', name: 'French', nativeName: 'Fran├зais', rtl: false, flag: 'ЁЯЗлЁЯЗ╖' },
  de: { code: 'de', name: 'German', nativeName: 'Deutsch', rtl: false, flag: 'ЁЯЗйЁЯЗк' },
  zh: { code: 'zh', name: 'Chinese', nativeName: 'ф╕нцЦЗ', rtl: false, flag: 'ЁЯЗиЁЯЗ│' }
}

export interface TranslationDictionary {
  [key: string]: string | TranslationDictionary
}

export interface I18nContextType {
  currentLanguage: SupportedLanguage
  direction: 'ltr' | 'rtl'
  isRTL: boolean
  setLanguage: (language: SupportedLanguage) => void
  t: (key: string, params?: Record<string, any>) => string
  formatNumber: (num: number, options?: Intl.NumberFormatOptions) => string
  formatDate: (date: Date, options?: Intl.DateTimeFormatOptions) => string
  formatCurrency: (amount: number, currency?: string) => string
}

const I18nContext = createContext<I18nContextType | null>(null)

// Translation dictionaries
const translations: Record<SupportedLanguage, TranslationDictionary> = {
  en: {
    // Navigation
    'nav.dashboard': 'Dashboard',
    'nav.websites': 'Websites',
    'nav.templates': 'Templates',
    'nav.analytics': 'Analytics',
    'nav.settings': 'Settings',
    'nav.help': 'Help',

    // Common
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.create': 'Create',
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.success': 'Success',

    // Dashboard
    'dashboard.welcome': 'Welcome to Pakistan Website Builder',
    'dashboard.subtitle': 'Create stunning websites with our AI-powered tools',
    'dashboard.create_website': 'Create Website',
    'dashboard.recent_websites': 'Recent Websites',
    'dashboard.quick_actions': 'Quick Actions',

    // Editor
    'editor.preview': 'Preview',
    'editor.publish': 'Publish',
    'editor.undo': 'Undo',
    'editor.redo': 'Redo',
    'editor.components': 'Components',
    'editor.settings': 'Settings',
    'editor.styles': 'Styles',

    // Forms
    'form.required': 'This field is required',
    'form.email': 'Please enter a valid email',
    'form.min_length': 'Minimum {{count}} characters required',
    'form.max_length': 'Maximum {{count}} characters allowed',

    // Accessibility
    'a11y.skip_links': 'Skip links',
    'a11y.skip_to_main': 'Skip to main content',
    'a11y.skip_to_nav': 'Skip to navigation',
    'a11y.skip_to_search': 'Skip to search',
    'a11y.close': 'Close',
    'a11y.loading': 'Loading',
    'a11y.error': 'Error occurred'
  },
  ur: {
    // Navigation
    'nav.dashboard': '┌И█М╪┤ ╪и┘И╪▒┌И',
    'nav.websites': '┘И█М╪и ╪│╪з╪ж┘╣╪│',
    'nav.templates': '┘╣█М┘Е┘╛┘Д█М┘╣╪│',
    'nav.analytics': '╪к╪м╪▓█М╪з╪к',
    'nav.settings': '╪к╪▒╪к█М╪и╪з╪к',
    'nav.help': '┘Е╪п╪п',

    // Common
    'common.save': '┘Е╪н┘Б┘И╪╕ ┌й╪▒█М┌║',
    'common.cancel': '┘Е┘Ж╪│┘И╪о ┌й╪▒█М┌║',
    'common.delete': '╪н╪░┘Б ┌й╪▒█М┌║',
    'common.edit': '╪к╪▒┘Е█М┘Е ┌й╪▒█М┌║',
    'common.create': '╪и┘Ж╪з╪ж█М┌║',
    'common.loading': '┘Д┘И┌И █Б┘И ╪▒█Б╪з █Б█Т...',
    'common.error': '╪о╪▒╪з╪и█М',
    'common.success': '┌й╪з┘Е█М╪з╪и█М',

    // Dashboard
    'dashboard.welcome': '┘╛╪з┌й╪│╪к╪з┘Ж ┘И█М╪и ╪│╪з╪ж┘╣ ╪и┘Д┌И╪▒ ┘Е█М┌║ ╪о┘И╪┤ ╪в┘Е╪п█М╪п',
    'dashboard.subtitle': '█Б┘Е╪з╪▒█М AI ┘╛╪з┘И╪▒┌И ┘╣┘И┘Д╪▓ ┌й█Т ╪│╪з╪к┌╛ ╪┤╪з┘Ж╪п╪з╪▒ ┘И█М╪и ╪│╪з╪ж┘╣╪│ ╪и┘Ж╪з╪ж█М┌║',
    'dashboard.create_website': '┘И█М╪и ╪│╪з╪ж┘╣ ╪и┘Ж╪з╪ж█М┌║',
    'dashboard.recent_websites': '╪н╪з┘Д█М█Б ┘И█М╪и ╪│╪з╪ж┘╣╪│',
    'dashboard.quick_actions': '┘Б┘И╪▒█М ╪з┘В╪п╪з┘Е╪з╪к',

    // Editor
    'editor.preview': '┘╛█М╪┤ ┘Ж╪╕╪з╪▒█Б',
    'editor.publish': '╪┤╪з╪ж╪╣ ┌й╪▒█М┌║',
    'editor.undo': '┘И╪з┘╛╪│',
    'editor.redo': '╪п┘И╪и╪з╪▒█Б',
    'editor.components': '╪з╪м╪▓╪з╪б',
    'editor.settings': '╪к╪▒╪к█М╪и╪з╪к',
    'editor.styles': '╪╖╪▒╪▓█М┌║',

    // Forms
    'form.required': '█М█Б ┘Б█М┘Д┌И ╪╢╪▒┘И╪▒█М █Б█Т',
    'form.email': '╪и╪▒╪з█Б ┌й╪▒┘Е ╪п╪▒╪│╪к ╪з█М ┘Е█М┘Д ╪п╪▒╪м ┌й╪▒█М┌║',
    'form.min_length': '┌й┘Е ╪з╪▓ ┌й┘Е {{count}} ╪н╪▒┘И┘Б ╪п╪▒┌й╪з╪▒ █Б█М┌║',
    'form.max_length': '╪▓█М╪з╪п█Б ╪│█Т ╪▓█М╪з╪п█Б {{count}} ╪н╪▒┘И┘Б ┌й█М ╪з╪м╪з╪▓╪к █Б█Т',

    // Accessibility
    'a11y.skip_links': '╪м╪│╪к ┘Д┘Ж┌й╪│',
    'a11y.skip_to_main': '┘Е╪▒┌й╪▓█М ┘Е┘И╪з╪п ┘╛╪▒ ╪м╪з╪ж█М┌║',
    'a11y.skip_to_nav': '┘Ж█М┘И█М┌п█М╪┤┘Ж ┘╛╪▒ ╪м╪з╪ж█М┌║',
    'a11y.skip_to_search': '╪к┘Д╪з╪┤ ┘╛╪▒ ╪м╪з╪ж█М┌║',
    'a11y.close': '╪и┘Ж╪п ┌й╪▒█М┌║',
    'a11y.loading': '┘Д┘И┌И █Б┘И ╪▒█Б╪з █Б█Т',
    'a11y.error': '╪о╪▒╪з╪и█М ┘╛█М╪┤ ╪в┌п╪ж█М'
  },
  ar: {
    // Navigation
    'nav.dashboard': '┘Д┘И╪н╪й ╪з┘Д╪к╪н┘Г┘Е',
    'nav.websites': '╪з┘Д┘Е┘И╪з┘В╪╣',
    'nav.templates': '╪з┘Д┘В┘И╪з┘Д╪и',
    'nav.analytics': '╪з┘Д╪к╪н┘Д┘К┘Д╪з╪к',
    'nav.settings': '╪з┘Д╪е╪╣╪п╪з╪п╪з╪к',
    'nav.help': '╪з┘Д┘Е╪│╪з╪╣╪п╪й',

    // Common
    'common.save': '╪н┘Б╪╕',
    'common.cancel': '╪е┘Д╪║╪з╪б',
    'common.delete': '╪н╪░┘Б',
    'common.edit': '╪к╪н╪▒┘К╪▒',
    'common.create': '╪е┘Ж╪┤╪з╪б',
    'common.loading': '╪м╪з╪▒┘К ╪з┘Д╪к╪н┘Е┘К┘Д...',
    'common.error': '╪о╪╖╪г',
    'common.success': '┘Ж╪м╪н',

    // Dashboard
    'dashboard.welcome': '┘Е╪▒╪н╪и╪з┘Л ╪и┘Г ┘Б┘К ╪и╪з┘Ж┘К ┘Е┘И╪з┘В╪╣ ╪и╪з┘Г╪│╪к╪з┘Ж',
    'dashboard.subtitle': '╪г┘Ж╪┤╪ж ┘Е┘И╪з┘В╪╣ ╪▒╪з╪ж╪╣╪й ╪и╪г╪п┘И╪з╪к┘Ж╪з ╪з┘Д┘Е╪п╪╣┘И┘Е╪й ╪и╪з┘Д╪░┘Г╪з╪б ╪з┘Д╪з╪╡╪╖┘Ж╪з╪╣┘К',
    'dashboard.create_website': '╪е┘Ж╪┤╪з╪б ┘Е┘И┘В╪╣',
    'dashboard.recent_websites': '╪з┘Д┘Е┘И╪з┘В╪╣ ╪з┘Д╪г╪о┘К╪▒╪й',
    'dashboard.quick_actions': '╪з┘Д╪е╪м╪▒╪з╪б╪з╪к ╪з┘Д╪│╪▒┘К╪╣╪й',

    // Editor
    'editor.preview': '┘Е╪╣╪з┘К┘Ж╪й',
    'editor.publish': '┘Ж╪┤╪▒',
    'editor.undo': '╪к╪▒╪з╪м╪╣',
    'editor.redo': '╪е╪╣╪з╪п╪й',
    'editor.components': '╪з┘Д┘Е┘Г┘И┘Ж╪з╪к',
    'editor.settings': '╪з┘Д╪е╪╣╪п╪з╪п╪з╪к',
    'editor.styles': '╪з┘Д╪г┘Ж┘Е╪з╪╖',

    // Forms
    'form.required': '┘З╪░╪з ╪з┘Д╪н┘В┘Д ┘Е╪╖┘Д┘И╪и',
    'form.email': '┘К╪▒╪м┘Й ╪е╪п╪о╪з┘Д ╪и╪▒┘К╪п ╪е┘Д┘Г╪к╪▒┘И┘Ж┘К ╪╡╪н┘К╪н',
    'form.min_length': '┘Е╪╖┘Д┘И╪и {{count}} ╪г╪н╪▒┘Б ┘Г╪н╪п ╪г╪п┘Ж┘Й',
    'form.max_length': '┘Е╪│┘Е┘И╪н ╪и┘А {{count}} ╪н╪▒┘Б ┘Г╪н╪п ╪г┘В╪╡┘Й',

    // Accessibility
    'a11y.skip_links': '╪▒┘И╪з╪и╪╖ ╪з┘Д╪к╪о╪╖┘К',
    'a11y.skip_to_main': '╪к╪о╪╖┘К ╪е┘Д┘Й ╪з┘Д┘Е╪н╪к┘И┘Й ╪з┘Д╪▒╪ж┘К╪│┘К',
    'a11y.skip_to_nav': '╪к╪о╪╖┘К ╪е┘Д┘Й ╪з┘Д╪к┘Ж┘В┘Д',
    'a11y.skip_to_search': '╪к╪о╪╖┘К ╪е┘Д┘Й ╪з┘Д╪и╪н╪л',
    'a11y.close': '╪е╪║┘Д╪з┘В',
    'a11y.loading': '╪м╪з╪▒┘К ╪з┘Д╪к╪н┘Е┘К┘Д',
    'a11y.error': '╪н╪п╪л ╪о╪╖╪г'
  },
  hi: {
    // Navigation
    'nav.dashboard': 'рдбреИрд╢рдмреЛрд░реНрдб',
    'nav.websites': 'рд╡реЗрдмрд╕рд╛рдЗрдЯреЗрдВ',
    'nav.templates': 'рдЯреЗрдореНрдкреНрд▓реЗрдЯ',
    'nav.analytics': 'рдПрдирд╛рд▓рд┐рдЯрд┐рдХреНрд╕',
    'nav.settings': 'рд╕реЗрдЯрд┐рдВрдЧреНрд╕',
    'nav.help': 'рдорджрдж',

    // Common
    'common.save': 'рд╕реЗрд╡ рдХрд░реЗрдВ',
    'common.cancel': 'рдХреИрдВрд╕рд▓ рдХрд░реЗрдВ',
    'common.delete': 'рдбрд┐рд▓реАрдЯ рдХрд░реЗрдВ',
    'common.edit': 'рдПрдбрд┐рдЯ рдХрд░реЗрдВ',
    'common.create': 'рдмрдирд╛рдПрдВ',
    'common.loading': 'рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...',
    'common.error': 'рдПрд░рд░',
    'common.success': 'рд╕рдХреНрд╕реЗрд╕',

    // Dashboard
    'dashboard.welcome': 'рдкрд╛рдХрд┐рд╕реНрддрд╛рди рд╡реЗрдмрд╕рд╛рдЗрдЯ рдмрд┐рд▓реНрдбрд░ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ',
    'dashboard.subtitle': 'рд╣рдорд╛рд░реА AI-рдкрд╛рд╡рд░реНрдб рдЯреВрд▓реНрд╕ рдХреЗ рд╕рд╛рде рд╢рд╛рдирджрд╛рд░ рд╡реЗрдмрд╕рд╛рдЗрдЯреЗрдВ рдмрдирд╛рдПрдВ',
    'dashboard.create_website': 'рд╡реЗрдмрд╕рд╛рдЗрдЯ рдмрдирд╛рдПрдВ',
    'dashboard.recent_websites': 'рд╣рд╛рд▓ рдХреА рд╡реЗрдмрд╕рд╛рдЗрдЯреЗрдВ',
    'dashboard.quick_actions': 'рдХреНрд╡рд┐рдХ рдПрдХреНрд╢рдВрд╕',

    // Editor
    'editor.preview': 'рдкреНрд░рд┐рд╡реНрдпреВ',
    'editor.publish': 'рдкрдмреНрд▓рд┐рд╢ рдХрд░реЗрдВ',
    'editor.undo': 'рдЕрдиреНрдбреВ',
    'editor.redo': 'рд░реАрдбреВ',
    'editor.components': 'рдХреЙрдореНрдкреЛрдиреЗрдВрдЯреНрд╕',
    'editor.settings': 'рд╕реЗрдЯрд┐рдВрдЧреНрд╕',
    'editor.styles': 'рд╕реНрдЯрд╛рдЗрд▓реНрд╕',

    // Forms
    'form.required': 'рдпрд╣ рдлрд╝реАрд▓реНрдб рдЖрд╡рд╢реНрдпрдХ рд╣реИ',
    'form.email': 'рдХреГрдкрдпрд╛ рд╡реИрдз рдИрдореЗрд▓ рджрд░реНрдЬ рдХрд░реЗрдВ',
    'form.min_length': 'рдиреНрдпреВрдирддрдо {{count}} рд╡рд░реНрдг рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ',
    'form.max_length': 'рдЕрдзрд┐рдХрддрдо {{count}} рд╡рд░реНрдг рдЕрдиреБрдордд рд╣реИрдВ',

    // Accessibility
    'a11y.skip_to_main': 'рдореБрдЦреНрдп рд╕рд╛рдордЧреНрд░реА рдкрд░ рдЬрд╛рдПрдВ',
    'a11y.skip_to_nav': 'рдиреЗрд╡рд┐рдЧреЗрд╢рди рдкрд░ рдЬрд╛рдПрдВ',
    'a11y.skip_to_search': 'рдЦреЛрдЬ рдкрд░ рдЬрд╛рдПрдВ',
    'a11y.close': 'рдмрдВрдж рдХрд░реЗрдВ',
    'a11y.loading': 'рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ',
    'a11y.error': 'рддреНрд░реБрдЯрд┐ рд╣реБрдИ'
  },
  es: {
    'nav.dashboard': 'Panel',
    'nav.websites': 'Sitios Web',
    'nav.templates': 'Plantillas',
    'nav.analytics': 'An├бlisis',
    'nav.settings': 'Configuraci├│n',
    'nav.help': 'Ayuda',
    'common.save': 'Guardar',
    'common.cancel': 'Cancelar',
    'common.delete': 'Eliminar',
    'common.edit': 'Editar',
    'common.create': 'Crear',
    'common.loading': 'Cargando...',
    'common.error': 'Error',
    'common.success': '├Йxito',
    'dashboard.welcome': 'Bienvenido al Constructor de Sitios Web de Pakist├бn',
    'dashboard.subtitle': 'Crea sitios web impresionantes con nuestras herramientas impulsadas por IA',
    'dashboard.create_website': 'Crear Sitio Web',
    'dashboard.recent_websites': 'Sitios Web Recientes',
    'dashboard.quick_actions': 'Acciones R├бpidas',
    'editor.preview': 'Vista Previa',
    'editor.publish': 'Publicar',
    'editor.undo': 'Deshacer',
    'editor.redo': 'Rehacer',
    'editor.components': 'Componentes',
    'editor.settings': 'Configuraci├│n',
    'editor.styles': 'Estilos',
    'form.required': 'Este campo es obligatorio',
    'form.email': 'Por favor ingresa un email v├бlido',
    'form.min_length': 'Se requieren m├нnimo {{count}} caracteres',
    'form.max_length': 'Se permiten m├бximo {{count}} caracteres',
    'a11y.skip_to_main': 'Saltar al contenido principal',
    'a11y.skip_to_nav': 'Saltar a la navegaci├│n',
    'a11y.skip_to_search': 'Saltar a la b├║squeda',
    'a11y.close': 'Cerrar',
    'a11y.loading': 'Cargando',
    'a11y.error': 'Error ocurrido'
  },
  fr: {
    'nav.dashboard': 'Tableau de Bord',
    'nav.websites': 'Sites Web',
    'nav.templates': 'Mod├иles',
    'nav.analytics': 'Analyses',
    'nav.settings': 'Param├иtres',
    'nav.help': 'Aide',
    'common.save': 'Enregistrer',
    'common.cancel': 'Annuler',
    'common.delete': 'Supprimer',
    'common.edit': 'Modifier',
    'common.create': 'Cr├йer',
    'common.loading': 'Chargement...',
    'common.error': 'Erreur',
    'common.success': 'Succ├иs',
    'dashboard.welcome': 'Bienvenue sur Pakistan Website Builder',
    'dashboard.subtitle': 'Cr├йez des sites web exceptionnels avec nos outils aliment├йs par IA',
    'dashboard.create_website': 'Cr├йer un Site Web',
    'dashboard.recent_websites': 'Sites Web R├йcents',
    'dashboard.quick_actions': 'Actions Rapides',
    'editor.preview': 'Aper├зu',
    'editor.publish': 'Publier',
    'editor.undo': 'Annuler',
    'editor.redo': 'R├йtablir',
    'editor.components': 'Composants',
    'editor.settings': 'Param├иtres',
    'editor.styles': 'Styles',
    'form.required': 'Ce champ est obligatoire',
    'form.email': 'Veuillez saisir un email valide',
    'form.min_length': '{{count}} caract├иres minimum requis',
    'form.max_length': '{{count}} caract├иres maximum autoris├йs',
    'a11y.skip_to_main': 'Aller au contenu principal',
    'a11y.skip_to_nav': 'Aller ├а la navigation',
    'a11y.skip_to_search': 'Aller ├а la recherche',
    'a11y.close': 'Fermer',
    'a11y.loading': 'Chargement',
    'a11y.error': 'Erreur survenue'
  },
  de: {
    'nav.dashboard': 'Dashboard',
    'nav.websites': 'Webseiten',
    'nav.templates': 'Vorlagen',
    'nav.analytics': 'Analytik',
    'nav.settings': 'Einstellungen',
    'nav.help': 'Hilfe',
    'common.save': 'Speichern',
    'common.cancel': 'Abbrechen',
    'common.delete': 'L├╢schen',
    'common.edit': 'Bearbeiten',
    'common.create': 'Erstellen',
    'common.loading': 'L├дdt...',
    'common.error': 'Fehler',
    'common.success': 'Erfolg',
    'dashboard.welcome': 'Willkommen bei Pakistan Website Builder',
    'dashboard.subtitle': 'Erstellen Sie atemberaubende Websites mit unseren KI-gest├╝tzten Tools',
    'dashboard.create_website': 'Website Erstellen',
    'dashboard.recent_websites': 'K├╝rzliche Websites',
    'dashboard.quick_actions': 'Schnellaktionen',
    'editor.preview': 'Vorschau',
    'editor.publish': 'Ver├╢ffentlichen',
    'editor.undo': 'R├╝ckg├дngig',
    'editor.redo': 'Wiederholen',
    'editor.components': 'Komponenten',
    'editor.settings': 'Einstellungen',
    'editor.styles': 'Stile',
    'form.required': 'Dieses Feld ist erforderlich',
    'form.email': 'Bitte geben Sie eine g├╝ltige E-Mail-Adresse ein',
    'form.min_length': 'Mindestens {{count}} Zeichen erforderlich',
    'form.max_length': 'Maximal {{count}} Zeichen erlaubt',
    'a11y.skip_to_main': 'Zum Hauptinhalt springen',
    'a11y.skip_to_nav': 'Zur Navigation springen',
    'a11y.skip_to_search': 'Zur Suche springen',
    'a11y.close': 'Schlie├Яen',
    'a11y.loading': 'L├дdt',
    'a11y.error': 'Fehler aufgetreten'
  },
  zh: {
    'nav.dashboard': 'ф╗кшбицЭ┐',
    'nav.websites': 'ч╜СчлЩ',
    'nav.templates': 'цибцЭ┐',
    'nav.analytics': 'хИЖцЮР',
    'nav.settings': 'шо╛ч╜о',
    'nav.help': 'х╕охКй',
    'common.save': 'ф┐ЭхнШ',
    'common.cancel': 'хПЦц╢И',
    'common.delete': 'хИащЩд',
    'common.edit': 'ч╝Цш╛С',
    'common.create': 'хИЫх╗║',
    'common.loading': 'хКаш╜╜ф╕н...',
    'common.error': 'щФЩшпп',
    'common.success': 'цИРхКЯ',
    'dashboard.welcome': 'цмвш┐Оф╜┐чФих╖┤хЯ║цЦпхЭжч╜СчлЩцЮДх╗║хЩи',
    'dashboard.subtitle': 'ф╜┐чФицИСф╗мчЪДф║║х╖ецЩ║шГ╜х╖ехЕ╖хИЫх╗║ф╗дф║║цГКхП╣чЪДч╜СчлЩ',
    'dashboard.create_website': 'хИЫх╗║ч╜СчлЩ',
    'dashboard.recent_websites': 'цЬАш┐СчЪДч╜СчлЩ',
    'dashboard.quick_actions': 'х┐лщАЯцУНф╜Ь',
    'editor.preview': 'щвДшзИ',
    'editor.publish': 'хПСх╕Г',
    'editor.undo': 'цТдщФА',
    'editor.redo': 'щЗНхБЪ',
    'editor.components': 'ч╗Дф╗╢',
    'editor.settings': 'шо╛ч╜о',
    'editor.styles': 'ца╖х╝П',
    'form.required': 'цндхнЧцо╡ф╕║х┐Ехблщб╣',
    'form.email': 'шп╖ш╛УхЕецЬЙцХИчЪДчФ╡хнРщВоф╗╢',
    'form.min_length': 'шЗ│х░СщЬАшжБ {{count}} ф╕кхнЧчмж',
    'form.max_length': 'цЬАхдЪхЕБшо╕ {{count}} ф╕кхнЧчмж',
    'a11y.skip_to_main': 'ш╖│ш╜мхИ░ф╕╗шжБхЖЕхо╣',
    'a11y.skip_to_nav': 'ш╖│ш╜мхИ░хп╝шИк',
    'a11y.skip_to_search': 'ш╖│ш╜мхИ░цРЬч┤в',
    'a11y.close': 'хЕ│щЧн',
    'a11y.loading': 'хКаш╜╜ф╕н',
    'a11y.error': 'хПСчФЯщФЩшпп'
  }
}

export function useInternationalization(defaultLanguage: SupportedLanguage = 'en') {
  const [currentLanguage, setCurrentLanguage] = useState<SupportedLanguage>(defaultLanguage)
  const [direction, setDirection] = useState<'ltr' | 'rtl'>('ltr')

  // Detect user language on mount
  useEffect(() => {
    const detectLanguage = (): SupportedLanguage => {
      // Check localStorage first
      const saved = localStorage.getItem('website-builder-language') as SupportedLanguage
      if (saved && SUPPORTED_LANGUAGES[saved]) {
        return saved
      }

      // Detect from browser
      const browserLang = navigator.language.split('-')[0] as SupportedLanguage
      if (SUPPORTED_LANGUAGES[browserLang]) {
        return browserLang
      }

      // Default fallback
      return defaultLanguage
    }

    const detectedLanguage = detectLanguage()
    setCurrentLanguage(detectedLanguage)
  }, [defaultLanguage])

  // Update direction when language changes
  useEffect(() => {
    const langInfo = SUPPORTED_LANGUAGES[currentLanguage]
    const newDirection = langInfo.rtl ? 'rtl' : 'ltr'
    setDirection(newDirection)

    // Update document direction
    document.documentElement.dir = newDirection
    document.documentElement.lang = currentLanguage

    // Save to localStorage
    localStorage.setItem('website-builder-language', currentLanguage)
  }, [currentLanguage])

  const setLanguage = useCallback((language: SupportedLanguage) => {
    if (SUPPORTED_LANGUAGES[language]) {
      setCurrentLanguage(language)
    }
  }, [])

  // Translation function
  const t = useCallback((key: string, params?: Record<string, any>): string => {
    const keys = key.split('.')
    let translation: any = translations[currentLanguage]

    for (const k of keys) {
      if (translation && typeof translation === 'object') {
        translation = translation[k]
      } else {
        translation = undefined
        break
      }
    }

    if (typeof translation !== 'string') {
      // Fallback to English
      translation = translations.en
      for (const k of keys) {
        if (translation && typeof translation === 'object') {
          translation = translation[k]
        } else {
          translation = undefined
          break
        }
      }

      // If still not found, return the key
      if (typeof translation !== 'string') {
        return key
      }
    }

    // Replace parameters
    if (params) {
      Object.keys(params).forEach(param => {
        translation = translation.replace(new RegExp(`{{${param}}}`, 'g'), params[param])
      })
    }

    return translation
  }, [currentLanguage])

  // Number formatting
  const formatNumber = useCallback((num: number, options?: Intl.NumberFormatOptions) => {
    return new Intl.NumberFormat(currentLanguage, options).format(num)
  }, [currentLanguage])

  // Date formatting
  const formatDate = useCallback((date: Date, options?: Intl.DateTimeFormatOptions) => {
    return new Intl.DateTimeFormat(currentLanguage, options).format(date)
  }, [currentLanguage])

  // Currency formatting
  const formatCurrency = useCallback((amount: number, currency: string = 'USD') => {
    return new Intl.NumberFormat(currentLanguage, {
      style: 'currency',
      currency
    }).format(amount)
  }, [currentLanguage])

  const isRTL = direction === 'rtl'

  return {
    currentLanguage,
    direction,
    isRTL,
    setLanguage,
    t,
    formatNumber,
    formatDate,
    formatCurrency,
    supportedLanguages: SUPPORTED_LANGUAGES
  }
}

// Provider component
export function I18nProvider({ children, defaultLanguage = 'en' }: { children: React.ReactNode, defaultLanguage?: SupportedLanguage }) {
  const i18n = useInternationalization(defaultLanguage)
  
  return (
    <I18nContext.Provider value={i18n}>
      {children}
    </I18nContext.Provider>
  )
}

// Hook to use i18n context
export function useI18n() {
  const context = useContext(I18nContext)
  if (!context) {
    throw new Error('useI18n must be used within an I18nProvider')
  }
  return context
}
